<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>canvas画布实现烟花绽放效果</title>
    <url>/2020/11/28/canvas%E7%94%BB%E5%B8%83%E5%AE%9E%E7%8E%B0%E7%83%9F%E8%8A%B1%E7%BB%BD%E6%94%BE%E6%95%88%E6%9E%9C/</url>
    <content><![CDATA[<h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h3><p><img src="http://image.berlin4h.top/images/2020/11/27/GIF-2020-11-27--17-48-40.gif" alt=""></p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>项目有个场景需求是要实现点击时，出现烟花绽放的效果，在网上百度了很多关于烟花的效果图，免费的不好看，好看的要钱，贫穷的打工人选择自己上手。</p>
<h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h3><h5 id="1、分解"><a href="#1、分解" class="headerlink" title="1、分解"></a>1、分解</h5><p>将所有烟花都分解成一个类似水滴形状的瓣，控制它的大小、坐标和旋转角度，叠加在一起就成了一朵好看的烟花。一个瓣可以看做是两条弯曲的曲线构成，曲线可由三次贝塞尔曲线绘制。</p>
<h5 id="2、水平绘制"><a href="#2、水平绘制" class="headerlink" title="2、水平绘制"></a>2、水平绘制</h5><p>假设初始坐标值为（x，y），瓣的宽度为w，高度为h，第一个拐角点设在宽度0.9位置（经过我的多次测试，这个位置绘制出的烟花最好看！）。</p>
<p><img src="http://image.berlin4h.top/images/2020/11/28/20201128112506.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ctx.beginPath();</span><br><span class="line">ctx.moveTo(x,y); &#x2F;&#x2F; 先将点放到初始坐标值</span><br><span class="line">ctx.bezierCurveTo(x+w*0.9，y-h&#x2F;2，x+w, y-h&#x2F;2, x+w,y); </span><br><span class="line">ctx.bezierCurveTo(x+w,y+h&#x2F;2,x+w*0.9,y+h&#x2F;2,x,y);&#x2F;&#x2F; 第二条曲线以第一条曲线的结束点为起始点</span><br></pre></td></tr></table></figure>

<h5 id="3、旋转角度"><a href="#3、旋转角度" class="headerlink" title="3、旋转角度"></a>3、旋转角度</h5><p>假设旋转角度为45度，如图计算出每个坐标的坐标值。</p>
<p><img src="http://image.berlin4h.top/images/2020/11/28/20201128120150.png" alt=""></p>
<h5 id="4、花瓣合成"><a href="#4、花瓣合成" class="headerlink" title="4、花瓣合成"></a>4、花瓣合成</h5><p>一层烟花由八朵烟花花瓣组成，分为左、右、上、下、左上、右上、左下、右下。由于canvas画布的坐标只有正数没有负数，因此可以计算出：</p>
<p>// 左 及 左上<br>目标横坐标 = 初始位置横坐标 - 对应点横坐标<br>目标纵坐标 = 初始位置纵坐标 - 对应点点纵坐标<br>// 上 及 右上<br>目标横坐标 = 初始位置横坐标 + 对应点点横坐标<br>目标纵坐标 = 初始位置纵坐标 - 对应点点纵坐标<br>// 右 及 右下<br>目标横坐标 = 初始位置横坐标 + 对应点点横坐标<br>目标纵坐标 = 初始位置纵坐标 + 对应点点纵坐标<br>// 下 及 左下<br>目标横坐标 = 初始位置横坐标 - 对应点点横坐标<br>目标纵坐标 = 初始位置纵坐标 + 对应点点纵坐标</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 假设a为偏移的角度，（x，y)为起始点坐标值，h为花瓣高度，w为花瓣宽度</span></span><br><span class="line"><span class="comment">// 左边花瓣代码示例</span></span><br><span class="line"><span class="keyword">var</span> angel = a;<span class="comment">//偏移的角度</span></span><br><span class="line"><span class="keyword">var</span> sinAngel = <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="keyword">var</span> cosAngel = <span class="built_in">Math</span>.cos(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="keyword">var</span> tanAngel = <span class="built_in">Math</span>.tan(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="keyword">var</span> hypotenuse = h / <span class="number">2</span> / <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="keyword">var</span> p1x = x - ((w * rate - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line"><span class="keyword">var</span> p1y = y - (w * rate - h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line"><span class="keyword">var</span> p2x = x - ((w - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line"><span class="keyword">var</span> p2y = y - (w - h / <span class="number">2</span> / tanAngel) * sinAngel ;</span><br><span class="line"><span class="keyword">var</span> p3x = x - w * cosAngel;</span><br><span class="line"><span class="keyword">var</span> p3y = y - w * sinAngel;</span><br><span class="line"><span class="keyword">var</span> p4x = x - ((w + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line"><span class="keyword">var</span> p4y = y - (w + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line"><span class="keyword">var</span> p5x = x - ((w * rate + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line"><span class="keyword">var</span> p5y = y - (w * rate + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">ctx.beginPath();</span><br><span class="line">ctx.moveTo(x,y);</span><br><span class="line">ctx.stroke();</span><br><span class="line">ctx.bezierCurveTo(p1x,p1y,p2x, p2y,p3x,p3y);</span><br><span class="line">ctx.bezierCurveTo(p4x, p4y,p5x,p5y,x,y);</span><br><span class="line">ctx.closePath();</span><br><span class="line">ctx.fillStyle = color;</span><br><span class="line">ctx.fill();</span><br></pre></td></tr></table></figure>

<h5 id="5、圆点坐标值"><a href="#5、圆点坐标值" class="headerlink" title="5、圆点坐标值"></a>5、圆点坐标值</h5><p>烟花可看做一圈一圈不同半径上的点为起始坐标的花瓣组成，每一圈有八个花瓣，根据三角函数可计算出点的坐标。</p>
<p><img src="http://image.berlin4h.top/images/2020/11/28/20201128135626.png" alt=""></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 假设偏移角度为angle，圆心坐标为(x,y)，半径为r</span></span><br><span class="line"><span class="comment">// 左</span></span><br><span class="line"><span class="keyword">var</span> p1x = x - r * <span class="built_in">Math</span>.cos(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="keyword">var</span> p1y = y - r * <span class="built_in">Math</span>.sin(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="comment">// 右</span></span><br><span class="line"><span class="keyword">var</span> p2x = x + r * <span class="built_in">Math</span>.cos(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="keyword">var</span> p2y = y + r * <span class="built_in">Math</span>.sin(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="comment">// 上</span></span><br><span class="line"><span class="keyword">var</span> p3x = x + r * <span class="built_in">Math</span>.sin(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="keyword">var</span> p3y = y - r * <span class="built_in">Math</span>.cos(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="comment">// 下</span></span><br><span class="line"><span class="keyword">var</span> p4x = x - r * <span class="built_in">Math</span>.sin(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="keyword">var</span> p4y = y + r * <span class="built_in">Math</span>.cos(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="comment">// 左上</span></span><br><span class="line"><span class="keyword">var</span> p5x = x - r * <span class="built_in">Math</span>.cos((angle + <span class="number">45</span>) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="keyword">var</span> p5y = y - r * <span class="built_in">Math</span>.sin((angle + <span class="number">45</span>) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="comment">// 右上</span></span><br><span class="line"><span class="keyword">var</span> p6x = x + r * <span class="built_in">Math</span>.cos((<span class="number">45</span> - angle) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="keyword">var</span> p6y = y - r * <span class="built_in">Math</span>.sin((<span class="number">45</span> - angle) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="comment">// 左下</span></span><br><span class="line"><span class="keyword">var</span> p7x = x - r * <span class="built_in">Math</span>.cos((<span class="number">45</span> - angle) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="keyword">var</span> p7y = y + r * <span class="built_in">Math</span>.sin((<span class="number">45</span> - angle) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="comment">// 右下</span></span><br><span class="line"><span class="keyword">var</span> p8x = x + r * <span class="built_in">Math</span>.cos((angle + <span class="number">45</span>) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line"><span class="keyword">var</span> p8y = y + r * <span class="built_in">Math</span>.sin((angle + <span class="number">45</span>) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br></pre></td></tr></table></figure>

<h5 id="6、最终实现"><a href="#6、最终实现" class="headerlink" title="6、最终实现"></a>6、最终实现</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 圆心横坐标、    圆心纵坐标、   半径、   偏移角度、     瓣高  、     瓣宽、    颜色 </span></span><br><span class="line"><span class="comment">// 第一圈</span></span><br><span class="line">calcEight(pointR, pointR, canvasW * <span class="number">0.05</span>, <span class="number">1</span>,canvasW * <span class="number">0.02</span>, canvasW * <span class="number">0.15</span>, <span class="string">"#E4AF6A"</span>);</span><br><span class="line">calcEight(pointR, pointR, canvasW * <span class="number">0.05</span>, <span class="number">11</span>,canvasW * <span class="number">0.02</span>, canvasW * <span class="number">0.15</span>, <span class="string">"#F8EEB0"</span>);</span><br><span class="line"><span class="comment">// 第二圈</span></span><br><span class="line">calcEight(pointR, pointR, canvasW * <span class="number">0.1</span>, <span class="number">28</span>,canvasW * <span class="number">0.08</span>, canvasW * <span class="number">0.35</span>, <span class="string">"#E4AF6A"</span>);</span><br><span class="line">calcEight(pointR, pointR, canvasW * <span class="number">0.1</span>, <span class="number">36</span>,canvasW * <span class="number">0.08</span>, canvasW * <span class="number">0.35</span>, <span class="string">"#F8EEB0"</span>);</span><br><span class="line"><span class="comment">// 第三圈</span></span><br><span class="line">calcEight(pointR, pointR, canvasW * <span class="number">0.075</span>, <span class="number">20</span>,canvasW * <span class="number">0.058</span>, canvasW * <span class="number">0.3</span>, <span class="string">"#E4AF6A"</span>);</span><br><span class="line">calcEight(pointR, pointR, canvasW * <span class="number">0.075</span>, <span class="number">28</span>,canvasW * <span class="number">0.058</span>, canvasW * <span class="number">0.3</span>, <span class="string">"#F8EEB0"</span>);</span><br><span class="line"><span class="comment">// 第四圈</span></span><br><span class="line">calcEight(pointR, pointR,  canvasW * <span class="number">0.29</span>, <span class="number">9</span>,canvasW * <span class="number">0.03</span>, canvasW * <span class="number">0.2</span>, <span class="string">"#E4AF6A"</span>);</span><br><span class="line">calcEight(pointR, pointR,  canvasW * <span class="number">0.29</span>, <span class="number">1</span>,canvasW * <span class="number">0.03</span>, canvasW * <span class="number">0.2</span>, <span class="string">"#F8EEB0"</span>);</span><br><span class="line"><span class="comment">// 左</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw1</span>(<span class="params">x,y,h,w, r,a,color</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> angel = a;</span><br><span class="line">    <span class="keyword">var</span> sinAngel = <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> cosAngel = <span class="built_in">Math</span>.cos(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> tanAngel = <span class="built_in">Math</span>.tan(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> hypotenuse = h / <span class="number">2</span> / <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p1x = x - ((w * rate - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p1y = y - (w * rate - h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p2x = x - ((w - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p2y = y - (w - h / <span class="number">2</span> / tanAngel) * sinAngel ;</span><br><span class="line">    <span class="keyword">var</span> p3x = x - w * cosAngel;</span><br><span class="line">    <span class="keyword">var</span> p3y = y - w * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p4x = x - ((w + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p4y = y - (w + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p5x = x - ((w * rate + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p5y = y - (w * rate + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.moveTo(x,y);</span><br><span class="line">    ctx.stroke();</span><br><span class="line">    ctx.bezierCurveTo(p1x,p1y,p2x, p2y,p3x,p3y);</span><br><span class="line">    ctx.bezierCurveTo(p4x, p4y,p5x,p5y,x,y);</span><br><span class="line">    ctx.closePath();</span><br><span class="line">    ctx.fillStyle = color;</span><br><span class="line">    ctx.fill();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 右</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw2</span>(<span class="params">x,y,h,w, r,a,color</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> angel = a;</span><br><span class="line">    <span class="keyword">var</span> sinAngel = <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> cosAngel = <span class="built_in">Math</span>.cos(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> tanAngel = <span class="built_in">Math</span>.tan(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> hypotenuse = h / <span class="number">2</span> / <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p1x = x + ((w * rate - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p1y = y + (w * rate - h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p2x = x + ((w - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p2y = y + (w - h / <span class="number">2</span> / tanAngel) * sinAngel ;</span><br><span class="line">    <span class="keyword">var</span> p3x = x + w * cosAngel;</span><br><span class="line">    <span class="keyword">var</span> p3y = y + w * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p4x = x + ((w + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p4y = y + (w + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p5x = x + ((w * rate + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p5y = y + (w * rate + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.moveTo(x,y);</span><br><span class="line">    ctx.bezierCurveTo(p1x,p1y,p2x, p2y,p3x,p3y);</span><br><span class="line">    ctx.bezierCurveTo(p4x, p4y,p5x,p5y,x,y);</span><br><span class="line">    ctx.closePath();</span><br><span class="line">    ctx.fillStyle = color;</span><br><span class="line">    ctx.fill();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 上</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw3</span>(<span class="params">x,y,h,w, r,a,color</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> angel = <span class="number">90</span> - a;</span><br><span class="line">    <span class="keyword">var</span> sinAngel = <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> cosAngel = <span class="built_in">Math</span>.cos(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> tanAngel = <span class="built_in">Math</span>.tan(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> hypotenuse = h / <span class="number">2</span> / <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p1x = x + ((w * rate - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p1y = y - (w * rate - h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p2x = x + ((w - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p2y = y - (w - h / <span class="number">2</span> / tanAngel) * sinAngel ;</span><br><span class="line">    <span class="keyword">var</span> p3x = x + w * cosAngel;</span><br><span class="line">    <span class="keyword">var</span> p3y = y - w * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p4x = x + ((w + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p4y = y - (w + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p5x = x + ((w * rate + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p5y = y - (w * rate + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.moveTo(x,y);</span><br><span class="line">    ctx.bezierCurveTo(p1x,p1y,p2x, p2y,p3x,p3y);</span><br><span class="line">    ctx.bezierCurveTo(p4x, p4y,p5x,p5y,x,y);</span><br><span class="line">    ctx.closePath();</span><br><span class="line">    ctx.fillStyle = color;</span><br><span class="line">    ctx.fill();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 下</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw4</span>(<span class="params">x,y,h,w, r,a,color</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> angel = <span class="number">90</span> - a;</span><br><span class="line">    <span class="keyword">var</span> sinAngel = <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> cosAngel = <span class="built_in">Math</span>.cos(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> tanAngel = <span class="built_in">Math</span>.tan(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> hypotenuse = h / <span class="number">2</span> / <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p1x = x - ((w * rate - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p1y = y + (w * rate - h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p2x = x - ((w - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p2y = y + (w - h / <span class="number">2</span> / tanAngel) * sinAngel ;</span><br><span class="line">    <span class="keyword">var</span> p3x = x - w * cosAngel;</span><br><span class="line">    <span class="keyword">var</span> p3y = y + w * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p4x = x - ((w + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p4y = y + (w + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p5x = x - ((w * rate + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p5y = y + (w * rate + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.moveTo(x,y);</span><br><span class="line">    ctx.bezierCurveTo(p1x,p1y,p2x, p2y,p3x,p3y);</span><br><span class="line">    ctx.bezierCurveTo(p4x, p4y,p5x,p5y,x,y);</span><br><span class="line">    ctx.closePath();</span><br><span class="line">    ctx.fillStyle = color;</span><br><span class="line">    ctx.fill();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 左上</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw5</span>(<span class="params">x,y,h,w, r,a,color</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> angel = a + <span class="number">45</span>;</span><br><span class="line">    <span class="keyword">var</span> sinAngel = <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> cosAngel = <span class="built_in">Math</span>.cos(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> tanAngel = <span class="built_in">Math</span>.tan(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> hypotenuse = h / <span class="number">2</span> / <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p1x = x - ((w * rate - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p1y = y - (w * rate - h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p2x = x - ((w - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p2y = y - (w - h / <span class="number">2</span> / tanAngel) * sinAngel ;</span><br><span class="line">    <span class="keyword">var</span> p3x = x - w * cosAngel;</span><br><span class="line">    <span class="keyword">var</span> p3y = y - w * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p4x = x - ((w + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p4y = y - (w + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p5x = x - ((w * rate + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p5y = y - (w * rate + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.moveTo(x,y);</span><br><span class="line">    ctx.stroke();</span><br><span class="line">    ctx.bezierCurveTo(p1x,p1y,p2x, p2y,p3x,p3y);</span><br><span class="line">    ctx.bezierCurveTo(p4x, p4y,p5x,p5y,x,y);</span><br><span class="line">    ctx.closePath();</span><br><span class="line">    ctx.fillStyle = color;</span><br><span class="line">    ctx.fill();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 右上</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw6</span>(<span class="params">x,y,h,w, r,a,color</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> angel = <span class="number">45</span> - a;</span><br><span class="line">    <span class="keyword">var</span> sinAngel = <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> cosAngel = <span class="built_in">Math</span>.cos(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> tanAngel = <span class="built_in">Math</span>.tan(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> hypotenuse = h / <span class="number">2</span> / <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p1x = x + ((w * rate - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p1y = y - (w * rate - h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p2x = x + ((w - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p2y = y - (w - h / <span class="number">2</span> / tanAngel) * sinAngel ;</span><br><span class="line">    <span class="keyword">var</span> p3x = x + w * cosAngel;</span><br><span class="line">    <span class="keyword">var</span> p3y = y - w * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p4x = x + ((w + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p4y = y - (w + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p5x = x + ((w * rate + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p5y = y - (w * rate + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.moveTo(x,y);</span><br><span class="line">    ctx.bezierCurveTo(p1x,p1y,p2x, p2y,p3x,p3y);</span><br><span class="line">    ctx.bezierCurveTo(p4x, p4y,p5x,p5y,x,y);</span><br><span class="line">    ctx.closePath();</span><br><span class="line">    ctx.fillStyle = color;</span><br><span class="line">    ctx.fill();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 左下</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw7</span>(<span class="params">x,y,h,w, r,a,color</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> angel = <span class="number">45</span> - a;</span><br><span class="line">    <span class="keyword">var</span> sinAngel = <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> cosAngel = <span class="built_in">Math</span>.cos(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> tanAngel = <span class="built_in">Math</span>.tan(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> hypotenuse = h / <span class="number">2</span> / <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p1x = x - ((w * rate - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p1y = y + (w * rate - h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p2x = x - ((w - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p2y = y + (w - h / <span class="number">2</span> / tanAngel) * sinAngel ;</span><br><span class="line">    <span class="keyword">var</span> p3x = x - w * cosAngel;</span><br><span class="line">    <span class="keyword">var</span> p3y = y + w * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p4x = x - ((w + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p4y = y + (w + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p5x = x - ((w * rate + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p5y = y + (w * rate + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.moveTo(x,y);</span><br><span class="line">    ctx.bezierCurveTo(p1x,p1y,p2x, p2y,p3x,p3y);</span><br><span class="line">    ctx.bezierCurveTo(p4x, p4y,p5x,p5y,x,y);</span><br><span class="line">    ctx.closePath();</span><br><span class="line">    ctx.fillStyle = color;</span><br><span class="line">    ctx.fill();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 右下</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw8</span>(<span class="params">x,y,h,w, r,a,color</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> angel = <span class="number">45</span> + a;</span><br><span class="line">    <span class="keyword">var</span> sinAngel = <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> cosAngel = <span class="built_in">Math</span>.cos(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> tanAngel = <span class="built_in">Math</span>.tan(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> hypotenuse = h / <span class="number">2</span> / <span class="built_in">Math</span>.sin(angel*<span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p1x = x + ((w * rate - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p1y = y + (w * rate - h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p2x = x + ((w - h / <span class="number">2</span> / tanAngel) * cosAngel + hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p2y = y + (w - h / <span class="number">2</span> / tanAngel) * sinAngel ;</span><br><span class="line">    <span class="keyword">var</span> p3x = x + w * cosAngel;</span><br><span class="line">    <span class="keyword">var</span> p3y = y + w * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p4x = x + ((w + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p4y = y + (w + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    <span class="keyword">var</span> p5x = x + ((w * rate + h / <span class="number">2</span> / tanAngel) * cosAngel - hypotenuse);</span><br><span class="line">    <span class="keyword">var</span> p5y = y + (w * rate + h / <span class="number">2</span> / tanAngel) * sinAngel;</span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    ctx.moveTo(x,y);</span><br><span class="line">    ctx.bezierCurveTo(p1x,p1y,p2x, p2y,p3x,p3y);</span><br><span class="line">    ctx.bezierCurveTo(p4x, p4y,p5x,p5y,x,y);</span><br><span class="line">    ctx.closePath();</span><br><span class="line">    ctx.fillStyle = color;</span><br><span class="line">    ctx.fill();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calcEight</span>(<span class="params">x,y,r, angle,h, w, color</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 左</span></span><br><span class="line">    <span class="keyword">var</span> p1x = x - r * <span class="built_in">Math</span>.cos(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p1y = y - r * <span class="built_in">Math</span>.sin(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="comment">// 右</span></span><br><span class="line">    <span class="keyword">var</span> p2x = x + r * <span class="built_in">Math</span>.cos(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p2y = y + r * <span class="built_in">Math</span>.sin(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="comment">// 上</span></span><br><span class="line">    <span class="keyword">var</span> p3x = x + r * <span class="built_in">Math</span>.sin(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p3y = y - r * <span class="built_in">Math</span>.cos(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="comment">// 下</span></span><br><span class="line">    <span class="keyword">var</span> p4x = x - r * <span class="built_in">Math</span>.sin(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p4y = y + r * <span class="built_in">Math</span>.cos(angle * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="comment">// 左上</span></span><br><span class="line">    <span class="keyword">var</span> p5x = x - r * <span class="built_in">Math</span>.cos((angle + <span class="number">45</span>) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p5y = y - r * <span class="built_in">Math</span>.sin((angle + <span class="number">45</span>) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="comment">// 右上</span></span><br><span class="line">    <span class="keyword">var</span> p6x = x + r * <span class="built_in">Math</span>.cos((<span class="number">45</span> - angle) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p6y = y - r * <span class="built_in">Math</span>.sin((<span class="number">45</span> - angle) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="comment">// 左下</span></span><br><span class="line">    <span class="keyword">var</span> p7x = x - r * <span class="built_in">Math</span>.cos((<span class="number">45</span> - angle) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p7y = y + r * <span class="built_in">Math</span>.sin((<span class="number">45</span> - angle) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="comment">// 右下</span></span><br><span class="line">    <span class="keyword">var</span> p8x = x + r * <span class="built_in">Math</span>.cos((angle + <span class="number">45</span>) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">var</span> p8y = y + r * <span class="built_in">Math</span>.sin((angle + <span class="number">45</span>) * <span class="built_in">Math</span>.PI / <span class="number">180</span>);</span><br><span class="line">    <span class="comment">// 左</span></span><br><span class="line">    draw1(p1x, p1y, h, w, <span class="built_in">Math</span>.PI,angle,color);</span><br><span class="line">    <span class="comment">// 右</span></span><br><span class="line">    draw2(p2x, p2y, h, w, <span class="built_in">Math</span>.PI,angle,color);</span><br><span class="line">    <span class="comment">// 上</span></span><br><span class="line">    draw3(p3x, p3y, h, w, <span class="built_in">Math</span>.PI / <span class="number">2</span>,angle,color);</span><br><span class="line">    <span class="comment">// 下</span></span><br><span class="line">    draw4(p4x, p4y, h, w, <span class="built_in">Math</span>.PI / <span class="number">2</span>,angle,color);</span><br><span class="line">    <span class="comment">// 左上</span></span><br><span class="line">    draw5(p5x, p5y, h, w, <span class="built_in">Math</span>.PI,angle,color);</span><br><span class="line">    <span class="comment">// 右上</span></span><br><span class="line">    draw6(p6x, p6y, h, w, <span class="built_in">Math</span>.PI,angle,color);</span><br><span class="line">    <span class="comment">// 左下</span></span><br><span class="line">    draw7(p7x, p7y, h, w, <span class="built_in">Math</span>.PI / <span class="number">2</span>,angle,color);</span><br><span class="line">    <span class="comment">// 右下</span></span><br><span class="line">    draw8(p8x, p8y, h, w, <span class="built_in">Math</span>.PI / <span class="number">2</span>,angle,color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="7、动画效果"><a href="#7、动画效果" class="headerlink" title="7、动画效果"></a>7、动画效果</h5><p>将画布的大小分成30，每50ms加一份，以此来改变每个花瓣的大小以及初始坐标的位置，达到逐渐变大的动画效果。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> pointR = canvasWidth / <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> cw = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> aT = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> cwSpeed = canvasWidth / <span class="number">30</span>;<span class="comment">// 画布大小增长速度</span></span><br><span class="line"><span class="keyword">var</span> aSpeed = <span class="number">45</span> / <span class="number">30</span>;</span><br><span class="line"><span class="keyword">var</span> timer = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(cw &lt; canvasWidth)</span><br><span class="line">    &#123;</span><br><span class="line">        cw += cwSpeed;</span><br><span class="line">        ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvasWidth, canvasWidth);</span><br><span class="line">        ctx.fill();</span><br><span class="line">        draw(cw, pointR, aT);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        ctx.globalAlpha = <span class="number">0</span>;</span><br><span class="line">        clearInterval(timer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">50</span>);</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>canvas</tag>
      </tags>
  </entry>
</search>
